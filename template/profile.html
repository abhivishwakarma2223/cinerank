{% extends 'base.html' %}
{% load static %}

{% block body %}



<div class="profile-container">
  <div class="profile-card">

    <!-- LEFT: avatar + upload -->
    <div class="profile-identity">

      <div class="profile-avatar">
        {% if user.profile.image %}
          <img src="{{ user.profile.image.url }}?v={{ user.profile.image.name|urlencode }}" 
               alt="{{ request.user.username|default:'User' }} avatar">
        {% else %}
          <img src="{% static 'images/default-avatar.png' %}" alt="default avatar">
        {% endif %}
      </div>

      <h2>{{ request.user.username|capfirst }}</h2>
      <p class="member-since">Member Since: {{ request.user.date_joined|date:"M d, Y" }}</p>

      <!-- Image Upload Form (FUNCTIONALITY UNCHANGED) -->
      <form id="profile-image-form" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        
        <!-- Hidden input (keep id & name unchanged) -->
        <input id="profile-image-input" name="image" type="file" accept="image/*" style="display:none;">

        <!-- Upload button -->
        <label for="profile-image-input" class="file-upload-label">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24">
            <path d="M12 7v10" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            <path d="M15 10l-3-3-3 3" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            <rect x="3" y="5" width="18" height="14" rx="2" stroke="currentColor" stroke-width="1.2"/>
          </svg>
          Upload / Change Picture
        </label>

    

        <a href="{% url 'edit_profile' %}" class="submit-btn" style="display:inline-block; padding:10px 20px; margin-top:15px;">
          <i class="fas fa-user-edit"></i> Edit Profile
        </a>

        <!-- fallback submit (hidden) -->
        <button id="profile-image-submit" type="submit" style="display:none;">Upload</button>
      </form>

    </div>

    <!-- RIGHT: Details -->
    <div class="profile-details">

      <div class="detail-group">
        <h3><i class="fas fa-envelope"></i> Contact Details</h3>

        <div class="info-item">
          <strong>Email:</strong>
          <span class="meta-badge">{{ request.user.email }}</span>
        </div>

        <div class="info-item">
          <strong>Status:</strong>
          <span class="meta-badge">Active</span>
        </div>
      </div>

      <div class="detail-group">
        <h3><i class="fas fa-chart-line"></i> Activity & Preferences</h3>

        <div class="info-item">
          <strong>Total Ratings:</strong>
          <span class="meta-badge">{{ total_ratings }}</span>
        </div>

        <div class="info-item">
          <strong>Watchlist Items:</strong>
          <span class="meta-badge">{{ total_watchlist }}</span>
        </div>

        <div class="info-item">
          <strong>Favorite Genre:</strong>
          <span class="meta-badge">{{ favorite_genre_name }}</span>
        </div>

      </div>

    </div>

  </div>
</div>

<!-- JS: Auto-submit on image select -->
<script>
  (function () {
    const fileInput = document.getElementById('profile-image-input');
    const form = document.getElementById('profile-image-form');
    if (!fileInput || !form) return;

    fileInput.addEventListener('change', function () {
      if (fileInput.files && fileInput.files.length > 0) {
        form.submit(); // auto submit
      }
    });
  })();
</script>

{% endblock body %}
